var FILENAME="/full.csv",logs,ndx,dayOfWeekDim,appCatDim,appDim,rcvdbyteDim,timeDim,all,countPerDay,countPerAppCat,countPerApp,countPerTime,groupBytesDay,groupBytesByAppCat,dataCount=dc.dataCount("#data-count"),dayChart=dc.pieChart("#chart-ring-day"),appCatChart=dc.pieChart("#chart-ring-app-cat"),appChart=dc.rowChart("#chart-row-app"),bytesDayChart=dc.pieChart("#chart-ring-bytes-day"),timeChart=dc.lineChart("#chart-line-time"),bytesAppCatChart=dc.pieChart("#chart-ring-bytes-app-cat");d3.csv(FILENAME,function(t){logs=t;var e=d3.time.format("%Y-%m-%dT%H:%M:%S"),a=d3.time.format("%H:%M:%S"),r=d3.time.format("%A");logs.forEach(function(t){t.appid=+t.appid,t.dstport=+t.dstport,t.duration=+t.duration,t.rcvdbyte=+t.rcvdbyte,t.rcvdpkt=+t.rcvdbyte,t.sentbyte=+t.sentbyte,t.sentpkt=+t.sentpkt,t.sessionid=+t.sessionid,t.srcport=+t.srcport,t.dt=e.parse(t.datetime),t.t=a.parse(t.time),t.day_of_week=r(t.dt)}),console.log(logs[0]),ndx=crossfilter(logs),dayOfWeekDim=ndx.dimension(function(t){return t.day_of_week}),appCatDim=ndx.dimension(function(t){return t.appcat}),appDim=ndx.dimension(function(t){return t.app}),rcvdbyteDim=ndx.dimension(function(t){return t.rcvdbyte}),timeDim=ndx.dimension(function(t){return d3.time.minute(t.t)}),all=ndx.groupAll(),countPerDay=dayOfWeekDim.group().reduceCount(),countPerAppCat=appCatDim.group().reduceCount(),countPerApp=appDim.group().reduceCount(),countPerTime=timeDim.group().reduceSum(function(t){return t.rcvdbyte/1e6}),groupBytesDay=dayOfWeekDim.group().reduceSum(function(t){return t.rcvdbyte/1e6}),groupBytesByAppCat=appCatDim.group().reduceSum(function(t){return t.rcvdbyte/1e6}),dataCount.dimension(ndx).group(all),dayChart.width(200).height(200).dimension(dayOfWeekDim).group(countPerDay).innerRadius(20).ordering(function(t){var e={Sunday:0,Monday:1,Tuesday:2,Wednesday:3,Thursday:4,Friday:5,Saturday:6};return e[t.key]}),appCatChart.width(200).height(200).dimension(appCatDim).group(countPerAppCat).innerRadius(20),bytesDayChart.width(200).height(200).dimension(dayOfWeekDim).group(groupBytesDay).innerRadius(20).ordering(function(t){var e={Sunday:0,Monday:1,Tuesday:2,Wednesday:3,Thursday:4,Friday:5,Saturday:6};return e[t.key]}),bytesAppCatChart.width(200).height(200).dimension(appCatDim).group(groupBytesByAppCat).innerRadius(20).ordering(function(t){var e={Sunday:0,Monday:1,Tuesday:2,Wednesday:3,Thursday:4,Friday:5,Saturday:6};return e[t.key]}),appChart.width(300).height(1600).margins({top:10,left:20,right:20,bottom:20}).dimension(appDim).group(countPerApp).elasticX(!0),timeChart.width(720).height(200).margins({top:10,left:50,right:20,bottom:20}).renderArea(!0).dimension(timeDim).group(countPerTime).elasticY(!0).x(d3.time.scale().domain(d3.extent(logs,function(t){return t.t}))).y(d3.scale),dc.renderAll()}),d3.selectAll("a#all").on("click",function(){dc.filterAll(),dc.renderAll()}),d3.selectAll("a#time").on("click",function(){timeChart.filterAll(),dc.redrawAll()}),d3.selectAll("a#day").on("click",function(){dayChart.filterAll(),dc.redrawAll()}),d3.selectAll("a#app-cat").on("click",function(){appCatChart.filterAll(),dc.redrawAll()}),d3.selectAll("a#bytes-day").on("click",function(){bytesDayChart.filterAll(),dc.redrawAll()}),d3.selectAll("a#bytes-app-cat").on("click",function(){bytesAppCatChart.filterAll(),dc.redrawAll()}),d3.selectAll("a#app").on("click",function(){appChart.filterAll(),dc.redrawAll()});